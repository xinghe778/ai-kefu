# 个人资料功能说明文档

## 功能概述

为YiZi AI智能客服系统V3.0新增了个人资料设置页面，允许用户管理个人信息和安全设置。

## 新增文件

### 1. `/admin/profile.php` - 个人资料管理页面
**功能特性：**
- ✅ 用户信息查看和编辑
- ✅ 邮箱地址更新
- ✅ 密码修改功能
- ✅ 用户统计数据展示
- ✅ 安全的密码验证
- ✅ 响应式设计，支持移动端

**主要功能：**

#### 用户信息管理
- 显示用户名（只读）
- 修改邮箱地址
- 用户注册日期显示

#### 安全设置
- 当前密码验证
- 新密码设置（最少6位）
- 密码确认机制
- 密码强度提示

#### 统计数据
- 注册日期
- 总对话次数
- 系统用户数（管理员可见）

## 修改文件

### 1. `/admin/header.php` - 管理面板导航
**修改内容：**
- 桌面端：用户下拉菜单中已包含"个人资料"链接
- 移动端：添加了"个人资料"菜单项

### 2. `/index_v2.php` - 前端聊天界面
**修改内容：**
- 添加用户下拉菜单功能
- 点击用户名显示菜单选项
- 包含"个人资料"和"退出登录"选项
- 响应式菜单设计
- 点击外部自动关闭菜单

## 安全特性

### 1. 身份验证
- 只有已登录用户可以访问个人资料页面
- 未登录用户自动跳转到登录页面

### 2. 密码安全
- 修改密码必须输入当前密码验证
- 新密码最少6位字符
- 密码使用PHP的`password_hash()`加密存储

### 3. 数据验证
- 邮箱格式验证
- SQL注入防护（使用预处理语句）
- XSS防护（输出转义）

## 用户界面设计

### 1. 管理端 (`admin/profile.php`)
- **现代化卡片设计**：渐变背景、玻璃态效果
- **用户头像**：大号圆形头像显示用户名首字母
- **统计卡片**：直观的数据展示
- **表单验证**：实时表单验证和错误提示
- **响应式布局**：适配各种屏幕尺寸

### 2. 前端聊天界面 (`index_v2.php`)
- **用户下拉菜单**：简洁的用户菜单设计
- **主题适配**：支持亮色/暗色主题切换
- **动画效果**：平滑的菜单展开/收缩动画
- **移动端优化**：触摸友好的交互设计

## 导航路径

### 管理员用户：
1. 登录后 → 管理面板 → 用户下拉菜单 → 个人资料
2. 或直接访问：`admin/profile.php`

### 普通用户：
1. 登录后 → 聊天界面 → 用户名点击 → 个人资料
2. 或直接访问：`admin/profile.php`

### 游客用户：
- 访问个人资料页面会自动跳转到登录页面

## 数据库操作

### 读取用户信息：
```sql
SELECT * FROM users WHERE id = ?
```

### 更新邮箱：
```sql
UPDATE users SET email = ? WHERE id = ?
```

### 更新密码：
```sql
UPDATE users SET password = ? WHERE id = ?
```

### 获取对话统计：
```sql
SELECT COUNT(*) FROM chat_logs WHERE user_id = ?
```

## 错误处理

### 1. 表单验证错误：
- 邮箱格式不正确
- 当前密码错误
- 新密码和确认密码不匹配
- 新密码长度不足

### 2. 系统错误：
- 用户信息不存在
- 数据库连接失败
- 权限不足

### 3. 错误提示：
- 成功消息：绿色提示框，自动消失
- 错误消息：红色提示框
- 友好的中文提示信息

## 技术实现

### 1. 前端技术：
- HTML5 + CSS3
- Bootstrap 5 组件库
- Font Awesome 图标
- JavaScript 交互逻辑
- CSS 自定义属性（主题支持）

### 2. 后端技术：
- PHP 7.4+
- PDO 数据库抽象层
- MySQL 5.7+
- Session 会话管理
- 密码哈希算法

### 3. 安全措施：
- CSRF保护（会话基础）
- SQL注入防护
- XSS防护
- 密码强度验证
- 输入数据过滤

## 部署说明

### 1. 文件部署：
将 `admin/profile.php` 部署到服务器的管理目录中

### 2. 权限设置：
确保Web服务器对个人资料页面有读取权限

### 3. 测试步骤：
1. 访问登录页面并登录
2. 点击用户名/头像查看下拉菜单
3. 点击"个人资料"进入设置页面
4. 测试邮箱修改功能
5. 测试密码修改功能
6. 验证统计数据显示

## 兼容性

### 浏览器支持：
- Chrome 60+
- Firefox 60+
- Safari 12+
- Edge 79+

### 设备支持：
- 桌面电脑（Windows/macOS/Linux）
- 平板设备（iPad/Android Tablet）
- 智能手机（iOS/Android）

### PHP版本：
- PHP 7.4 或更高版本
- 支持 PHP 8.0+

---

**版本信息：**
- 创建日期：2025-11-23
- 版本：V3.0
- 开发者：MiniMax Agent
- 状态：已完成并测试