# YiZi AI V3.0 完整部署与使用指南

## 🎉 功能概览

您的YiZi AI智能客服系统现在已经升级到V3.0，包含了以下完整功能：

### ✅ 已完成的核心功能
1. **用户权限控制系统** - 游客使用默认模型，注册用户可选择全部模型
2. **邀请码注册系统** - 管理员生成邀请码，用户需邀请码才能注册
3. **现代化聊天界面** - 美观、响应式、支持主题切换
4. **个人资料管理** - 用户可以修改个人信息、邮箱、密码
5. **管理后台** - 完整的数据统计、系统管理、用户管理功能

## 🚀 快速部署步骤

### 1. 数据库更新（重要）

**如果您的数据库之前遇到过字段错误，请先执行以下SQL：**
```sql
ALTER TABLE `chat_logs` 
ADD COLUMN `action` varchar(100) DEFAULT NULL,
ADD COLUMN `description` text;
```

**确保邀请码表存在：**
```sql
CREATE TABLE IF NOT EXISTS `invite_codes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `code` varchar(50) NOT NULL UNIQUE,
  `max_uses` int(11) DEFAULT 1,
  `used_count` int(11) DEFAULT 0,
  `expires_at` timestamp NULL DEFAULT NULL,
  `status` enum('active','inactive','expired') DEFAULT 'active',
  `created_by` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `used_by` int(11) DEFAULT NULL,
  `used_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
);
```

### 2. 文件部署
确保以下文件已正确部署到您的服务器：
- `admin/profile.php` - 个人资料页面
- `index_v2.php` - 现代化聊天界面
- `admin/header.php` - 更新的导航菜单

### 3. 权限设置
```bash
# 设置正确的文件权限
chmod 644 admin/profile.php
chmod 644 index_v2.php
chown www-data:www-data admin/profile.php
```

## 🎯 使用指南

### 管理员操作流程

#### 1. 登录管理后台
- 访问：`http://您的域名/admin/`
- 用户名：`admin`
- 密码：`admin123`

#### 2. 生成邀请码
- 点击"邀请码管理"
- 点击"生成邀请码"
- 设置使用次数和过期时间
- 复制邀请码给用户

#### 3. 用户管理
- 查看注册用户列表
- 管理用户权限
- 查看系统统计数据

#### 4. 个人资料设置
- 点击用户名 → "个人资料"
- 修改邮箱地址
- 更新登录密码
- 查看个人统计数据

### 普通用户操作流程

#### 1. 注册新账户
- 访问聊天界面：`http://您的域名/`
- 点击登录
- 使用邀请码完成注册
- 设置用户名和密码

#### 2. 开始对话
- 登录后可以选择AI模型
- 上传文件进行问答
- 查看对话历史

#### 3. 个人设置
- 点击用户名 → "个人资料"
- 修改个人信息
- 更新邮箱和密码

### 游客用户
- 可以直接访问聊天界面
- 使用默认的GPT-3.5模型
- 无法查看历史记录或使用高级功能

## 🛡️ 安全特性

### 用户认证
- 密码加密存储（PHP password_hash）
- Session会话管理
- 登录状态验证

### 数据保护
- SQL注入防护（预处理语句）
- XSS防护（输出转义）
- CSRF保护

### 权限控制
- 游客：仅默认模型
- 注册用户：全部模型
- 管理员：完整管理权限

## 📊 功能特性

### 前端界面（index_v2.php）
- **现代化设计**：渐变背景、玻璃态效果
- **主题切换**：支持亮色/暗色主题
- **响应式布局**：完美适配手机、平板、桌面
- **实时交互**：流畅的动画和反馈
- **文件上传**：支持文档、图片上传

### 管理后台（admin/）
- **数据统计**：实时数据看板
- **用户管理**：用户列表、权限管理
- **系统设置**：API配置、系统参数
- **日志查看**：完整的操作日志
- **邀请码管理**：邀请码生成和使用管理

### 个人资料页面（admin/profile.php）
- **信息管理**：邮箱、个人信息修改
- **密码安全**：安全的密码修改流程
- **数据统计**：个人使用统计
- **友好界面**：美观的卡片式设计

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 数据库错误
**问题**：`Table 'chat_logs' doesn't exist` 或 `Column 'action' not found`
**解决**：
```sql
-- 运行数据库修复脚本
ALTER TABLE `chat_logs` 
ADD COLUMN `action` varchar(100) DEFAULT NULL,
ADD COLUMN `description` text;
```

#### 2. 页面显示空白
**问题**：个人资料页面显示空白
**解决**：
- 检查PHP错误日志
- 确保数据库连接正常
- 检查文件权限设置

#### 3. 样式显示异常
**问题**：界面样式混乱
**解决**：
- 强制刷新页面（Ctrl+F5）
- 清除浏览器缓存
- 检查CSS文件是否正确加载

#### 4. 登录问题
**问题**：无法登录或忘记密码
**解决**：
- 默认管理员账户：admin / admin123
- 如需重置，联系系统管理员
- 检查数据库用户表是否正常

### 性能优化建议

#### 1. 服务器配置
- PHP 7.4+ 或 8.0+
- MySQL 5.7+ 或 8.0+
- 启用OPcache
- 配置适当的内存限制

#### 2. 数据库优化
```sql
-- 为常用字段添加索引
CREATE INDEX idx_user_id ON chat_logs(user_id);
CREATE INDEX idx_created_at ON chat_logs(created_at);
CREATE INDEX idx_action ON chat_logs(action);
```

#### 3. 缓存配置
- 启用浏览器缓存
- 配置CDN加速（可选）
- 使用Redis缓存会话（可选）

## 📈 版本更新记录

### V3.0 更新内容（2025-11-23）
- ✅ 新增用户权限控制系统
- ✅ 新增邀请码注册机制
- ✅ 重新设计现代化聊天界面
- ✅ 新增个人资料管理功能
- ✅ 修复数据库表结构问题
- ✅ 完善移动端适配
- ✅ 增强安全防护

### V2.5 基础功能
- 基础聊天对话功能
- 简单的用户管理
- 基本的文件上传
- 简单的日志记录

## 🎯 部署验证清单

### 基础功能验证
- [ ] 管理后台可以正常访问
- [ ] 可以生成和使用邀请码
- [ ] 用户注册流程正常
- [ ] 聊天功能正常工作
- [ ] 个人资料页面正常

### 权限验证
- [ ] 游客只能使用默认模型
- [ ] 注册用户可以使用全部模型
- [ ] 管理员有完整权限
- [ ] 未登录用户无法访问敏感页面

### 界面验证
- [ ] 桌面端界面正常显示
- [ ] 移动端界面正常显示
- [ ] 主题切换功能正常
- [ ] 响应式布局正常

### 安全验证
- [ ] 密码加密存储
- [ ] SQL注入防护有效
- [ ] XSS防护有效
- [ ] 会话管理正常

## 📞 技术支持

### 系统要求
- **服务器**：Linux/Windows/macOS
- **Web服务器**：Apache/Nginx
- **PHP版本**：7.4+（推荐8.0+）
- **数据库**：MySQL 5.7+ 或 8.0+
- **磁盘空间**：至少100MB
- **内存**：至少512MB

### 联系支持
如遇到技术问题，请提供：
1. 错误信息截图
2. PHP版本信息
3. 数据库版本信息
4. 操作步骤描述

---

**恭喜！您的YiZi AI V3.0系统已经完成部署，具备了完整的用户管理、权限控制、现代化界面和个人资料功能。现在您可以开始使用这个强大的智能客服系统了！** 🎉