# YiZi AI 智能客服系统 V3.0 更新说明

## 🚀 重大更新概览

### ✨ 新功能亮点
- **用户权限管理**：未注册游客只能使用基础模型，注册用户可使用全部模型
- **邀请码系统**：管理员可生成邀请码，用户需邀请码才能注册
- **现代化界面**：全新设计，简洁美观，响应式布局
- **增强交互**：更流畅的动画效果，更好的用户体验

---

## 📋 功能详细说明

### 1. 用户权限控制系统

#### 权限分级
- **游客模式**：未登录用户只能使用基础模型（gpt-3.5-turbo）
- **注册用户**：可使用全部可用模型（包含 GPT-4 等高级模型）
- **管理员**：拥有后台管理权限，可生成邀请码

#### 模型访问控制
```javascript
// 根据用户状态返回不同模型列表
未注册用户：["gpt-3.5-turbo", "gpt-3.5-turbo-16k"]
注册用户：所有可用模型
```

### 2. 邀请码管理系统

#### 功能特性
- ✅ **生成邀请码**：管理员可生成自定义或随机邀请码
- ✅ **过期时间**：支持设置邀请码有效期
- ✅ **使用次数**：支持单次或多次使用限制
- ✅ **状态跟踪**：实时显示邀请码使用状态
- ✅ **搜索筛选**：按状态、关键词搜索邀请码

#### 管理界面
- 📊 **统计面板**：总邀请码数、可用数、已使用数、过期数
- 🔍 **智能搜索**：支持按邀请码内容、描述搜索
- 📱 **响应式设计**：完美适配移动端操作

### 3. 现代化用户界面

#### 设计特色
- 🎨 **现代配色**：采用 CSS 变量系统，支持明暗双主题
- 💫 **流畅动画**：消息气泡滑入效果、主题切换过渡
- 🔄 **渐变设计**：按钮、图标采用精美渐变效果
- 📱 **移动优化**：完美适配各种屏幕尺寸

#### 界面组件
- **消息气泡**：卡片式设计，支持悬停效果和复制功能
- **输入区域**：智能拖放文件，自动调整高度
- **控制面板**：侧边栏模型选择和工具集合
- **主题切换**：一键切换明暗主题，记忆用户偏好

---

## 🔧 技术架构升级

### 后端 API 增强
```
admin/modelapi.php - 模型权限控制
admin/invitecode.php - 邀请码管理
admin/register.php - 注册邀请码验证
admin/invite-manager.php - 后台管理界面
```

### 数据库结构
```sql
-- 邀请码表
invite_codes (
    id, code, created_by, used_by, 
    status, max_uses, used_count, 
    expires_at, created_at
)

-- 用户表增强
users 表新增：
- invite_code_used 字段
```

### 前端技术栈
- **CSS 变量系统**：支持主题切换和一致性设计
- **响应式布局**：Bootstrap 5 + 自定义 CSS
- **现代化动画**：CSS3 动画 + JavaScript 交互
- **Markdown 渲染**：marked.js 支持代码高亮

---

## 📱 用户使用指南

### 游客用户
1. **直接访问**：无需注册即可使用基础 AI 功能
2. **限制说明**：只能使用 gpt-3.5-turbo 模型
3. **注册提示**：界面友好提示用户注册解锁更多功能

### 注册用户
1. **获取邀请码**：联系管理员获取邀请码
2. **填写注册**：用户名、邮箱（可选）、密码、邀请码
3. **权限升级**：注册成功后可使用全部模型
4. **数据持久**：聊天记录自动保存到本地

### 管理员
1. **邀请码生成**：后台 → 邀请码管理 → 生成邀请码
2. **用户管理**：用户列表、权限管理
3. **系统监控**：聊天日志、系统设置
4. **数据分析**：使用统计、活跃度分析

---

## 🛠️ 安装部署指南

### 1. 数据库初始化

```bash
# 创建数据库表
mysql -u root -p api < create_invite_codes.sql
mysql -u root -p api < user_input_files/install/database_init.sql
```

### 2. 文件部署

```bash
# 复制所有文件到网站根目录
cp -r user_input_files/* /var/www/html/

# 设置文件权限
chmod 755 /var/www/html/admin/*.php
chmod 777 /var/www/html/uploads/
```

### 3. 配置检查

- ✅ 数据库连接配置正确
- ✅ 默认管理员账户创建成功
- ✅ 邀请码表初始化完成
- ✅ API 密钥配置完成

### 4. 首次使用

1. **管理员登录**
   - 用户名：`admin`
   - 密码：`admin123`
   - ⚠️ **立即修改默认密码！**

2. **生成邀请码**
   - 访问后台 → 邀请码管理
   - 生成第一个邀请码供测试使用

3. **测试注册流程**
   - 使用邀请码注册新用户
   - 验证权限控制是否生效

---

## 🔐 安全建议

### 密码安全
- 强制用户设置强密码（6位以上）
- 使用 `password_hash()` 安全存储
- 管理员及时修改默认密码

### 邀请码管理
- 定期检查邀请码使用情况
- 及时清理过期邀请码
- 限制管理员邀请码生成权限

### API 安全
- 验证所有输入参数
- 使用 HTTPS 传输敏感数据
- 限制文件上传类型和大小

---

## 📊 功能测试清单

### ✅ 基础功能测试
- [ ] 用户注册（需要邀请码）
- [ ] 用户登录/登出
- [ ] 游客模式功能
- [ ] 注册用户模型访问

### ✅ 邀请码功能测试
- [ ] 生成邀请码
- [ ] 邀请码验证
- [ ] 邀请码状态管理
- [ ] 邀请码过期处理

### ✅ 前端界面测试
- [ ] 主题切换功能
- [ ] 响应式布局
- [ ] 消息发送/接收
- [ ] 文件上传功能
- [ ] 聊天记录保存

### ✅ 后端功能测试
- [ ] API 接口正常
- [ ] 数据库操作
- [ ] 日志记录
- [ ] 权限验证

### ✅ 移动端测试
- [ ] 手机浏览器适配
- [ ] 触摸操作流畅
- [ ] 侧边栏切换
- [ ] 文件上传体验

---

## 🆕 版本历史

### V3.0 (2025-11-23)
- 🆕 新增邀请码注册系统
- 🆕 新增用户权限控制
- 🎨 全新现代化界面设计
- 📱 优化移动端体验
- 🔧 增强后端 API 稳定性

### V2.5
- 基础聊天功能
- 管理员后台
- 文件上传支持

### V2.0
- 用户认证系统
- 知识库功能
- 聊天记录保存

### V1.0
- 初始版本
- 基础 AI 对话

---

## 🤝 支持与反馈

### 常见问题
1. **邀请码无效**：检查是否过期或已使用完毕
2. **模型无法加载**：检查 API 密钥和服务器连接
3. **文件上传失败**：检查文件大小和格式限制

### 技术支持
- 管理员后台查看错误日志
- 检查数据库连接状态
- 验证文件权限设置

---

## 📝 更新日志

**2025-11-23 V3.0**
- 重构用户界面，采用现代化设计语言
- 新增邀请码注册机制
- 实现基于用户角色的模型访问控制
- 优化移动端用户体验
- 增强系统安全性和稳定性

---

*YiZi AI V3.0 - 让 AI 对话更智能、更安全、更美观* ✨